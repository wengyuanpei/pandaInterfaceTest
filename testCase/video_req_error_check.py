import requests
from time import sleep

header = {
    "Authorization": "Bearer eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiIxNjQwOTc2ODgyODYyOTg1MjE3Iiwic3ViIjoie1wiaWRcIjoxNjQwOTc2ODgyODYyOTg1MjE3LFwibW9iaWxlXCI6XCIrODYxNzM0NTA0MzM2NVwifSIsImV4cCI6MTcwMTUwNjY5OH0.ymw2DKZATXWxGJ7h88T29A1vaMGPGbWu-eNl_9nuk4xoDkThu9Q0AR6KqE84gG0Hj22W6bK5uLXr54bRpvcDqw",
    "Sn": "S01D1042330600005",
    "User-Uid": "1640976882862985217",
    "Kid-Uid": "1640976882862985217"}

def getVideoInfo(lessonId):
#视频课包模块
    modeId=[]
    modeId.append(lessonId)

    # 获取视频id
    getVideoInfoUrl="https://hear.abctime.com/v1/lesson/"


    for modeId in modeId:
        getModeInfoUrl=getVideoInfoUrl+str(modeId)
        ModeInfo=requests.get(headers=header,url=getModeInfoUrl)
        return ModeInfo.json()['data']["medias_obj"]['video']


def getPlayUrlRsposeTime(videoId):
    playInfo='https://hear.abctime.com/v1/media/video/'+str(videoId)
    playInfoUrl=requests.get(headers=header,url=playInfo)
    if len(playInfoUrl.json()['data']) <2:
        return -1
    else:
        end_url=str(playInfoUrl.json()['data']['urls']['playUrls'][1]['playUrl'])
        resposeTime=requests.get(url=end_url)

        # 响应时间
        print("响应时间：",resposeTime.elapsed.total_seconds())
        # print(int(resposeTime.elapsed.total_seconds()*10))
        return resposeTime.elapsed.total_seconds()


lessonIdList=[80,
            83,
            84,
            85,
            86,
            87,
            88,
            90,
            91,
            92,
            93,
            94,
            95,
            96,
            97,
            98,
            99,
            100,
            103,
            104,
            106,
            107,
            115,
            161,
            165,
            169,
            171,
            186,
            190,
            191,
            192,
            193,
            194,
            195,
            196,
            197,
            198,
            199,
            200,
            214,
            215,
            216,
            217,
            218,
            219,
            220,
            221,
            222,
            223,
            224,
            225,
            230,
            231,
            232,
            233,
            234,
            235,
            236,
            237,
            238,
            239,
            240,
            241,
            242,
            243,
            244,
            245,
            247,
            248,
            249,
            250,
            251,
            252,
            253,
            254,
            255,
            256,
            257,
            258,
            259,
            260,
            261,
            262,
            264,
            265,
            266,
            267,
            268,
            269,
            270,
            271,
            273,
            274,
            275,
            276,
            277,
            278,
            279,
            280,
            281,
            282,
            283,
            284,
            285,
            286,
            287,
            288,
            289,
            290,
            291,
            292,
            293,
            294,
            295,
            296,
            325,
            326,
            327,
            328,
            329,
            330,
            331,
            332,
            333,
            334,
            335,
            336,
            344,
            345,
            346,
            347,
            348,
            349,
            350,
            351,
            352,
            353,
            354,
            355,
            356,
            357,
            358,
            359,
            360,
            361,
            362,
            363,
            364,
            365,
            366,
            367,
            368,
            369,
            370,
            371,
            373,
            374,
            375,
            376,
            377,
            378,
            379,
            380,
            381,
            382,
            383,
            384,
            385,
            386,
            387,
            388,
            389,
            390,
            391,
            392,
            393,
            394,
            395,
            396,
            397,
            398,
            399,
            400,
            401,
            402,
            403,
            404,
            405,
            406,
            407,
            408,
            409,
            410,
            411,
            412,
            413,
            414,
            415,
            416,
            417,
            418,
            419,
            420,
            421,
            422,
            423,
            424,
            425,
            426,
            427,
            428,
            429,
            430,
            431,
            432,
            433,
            434,
            435,
            436,
            437,
            438,
            439,
            440,
            441,
            442,
            443,
            444,
            445,
            473,
            476,
            507,
            508,
            509,
            510,
            511,
            512,
            513,
            514,
            516,
            530,
            531,
            532,
            533,
            534,
            535,
            536,
            537,
            538,
            539,
            540,
            541,
            542,
            543,
            544,
            545,
            546,
            547,
            548,
            549,
            550,
            551,
            552,
            553,
            554,
            555,
            556,
            557,
            558,
            559,
            560,
            561,
            562,
            563,
            565,
            566,
            567,
            568,
            569,
            570,
            571,
            572,
            573,
            637,
            638,
            640,
            641,
            642,
            643,
            644,
            645,
            646,
            647,
            648,
            649,
            650,
            651,
            652,
            653,
            654,
            655,
            656,
            657,
            658,
            659,
            660,
            661,
            662,
            663,
            664,
            665,
            666,
            682,
            683,
            684,
            685,
            686,
            687,
            688,
            689,
            690,
            691,
            692,
            693,]

errorList=[]
for lessonId in lessonIdList:

    for videoId in getVideoInfo(lessonId):
        sleep(2)
        timed=getPlayUrlRsposeTime(videoId)
        if timed <0:
            print(videoId, "视频id不存在！")

        elif timed > float(3):

            errorList.append(videoId)
        else:
            print("视频id:",videoId,"响应时间：",timed)

print("响应时间大于3秒，异常视频ID：",errorList)





